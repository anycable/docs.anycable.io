# Upgrading from 0.5.x to 0.6.0

## Rails

### Use `anycable` CLI instead of a generated `bin/anycable` script

```sh
# Before
$ bundle exec ./bin/anycable

# After:
$ bundle exec anycable
```

The old `./bin/anycable` file must be deleted.

If you made updates to the generated script, move the changes to `config/anycable.rb`:

```ruby
# config/anycable.rb

# NOTE: don't forget to load the application
require_relative "./environment.rb"

# < your custom AnyCable server related logic goes here >
```

**NOTE**: if you haven't changed the generated `./bin/anycable` script, you don't need to add `config/anycable.rb`.

**NOTE**: v0.6.0 is compatible with the `./bin/anycable` script generated by previous versions but you'll see a deprecation message.

### Use `:any_cable` subscription adapter

AnyCable integrates with the Action Cable pub/sub layer to broadcast data to WebSocket server (previously we used monkey-patching).

Now, to _activate_ AnyCable in your application you MUST use `:any_cable` adapter for Action Cable:

```yml
# config/cable.yml
production:
  adapter: any_cable
```

**NOTE:** now you can safely add `gem "anycable-rails"` to you `Gemfile` without any options (`require`, `group`): AnyCable doesn't break the Action Cable functionality unless `:any_cable` adapter is used.

### `REDIS_URL` used by default

If you already have `REDIS_URL` env for Redis configuration, you don't have to add `ANYCABLE_REDIS_URL` if you want to use the same Redis with AnyCable.

### Support for running a separate process from within RPC

AnyCable CLI provides an option to run any arbitrary process along with the RPC server. That could be useful for local development and even in production.

For example:

```sh
bundle exec anycable --server-command "anycable-go -p 3334"
```

The previous _hack_ for running `anycable-go` on Heroku is no longer needed (see [Heroku deployment](../deployment/heroku.md)).

## `anycable-go`

### CLI options

Update your CLI options:

```sh
# Before
$ anycable-go --addr=0.0.0.0:8080 \
              --wspath=/cable \
              --rpc=0.0.0.0:50051 \
              --redis=redis://localhost:6379/5 \
              --log

# After
$ anycable-go --host=0.0.0.0 --port=8080 \
              --path=/cable \
              --rpc_host=0.0.0.0:50051 \
              --redis_url=redis://localhost:6379/5 \
              --debug
```

### ENV configuration

Update your env vars according to the table:

0.5.x   | 0.6.x
--------|-------
RPC     |  ANYCABLE_RPC_HOST
REDIS   |  ANYCABLE_REDIS_URL (or REDIS_URL)
REDIS_CHANNEL | ANYCABLE_REDIS_CHANNEL
ADDR     |  Two vars: ANYCABLE_PORT (or PORT) and ANYCABLE_HOST
WSPATH | ANYCABLE_PATH
LOG  | ANYCABLE_DEBUG

All variables should be prefixed with `ANYCABLE_` (e.g. `ANYCABLE_HEADERS` instead of `HEADERS`).

### Homebrew

```sh
brew upgrade anycable-go
```
